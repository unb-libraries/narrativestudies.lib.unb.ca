language: php

services:
  - docker

php:
  - '7.2'

git:
  depth: 1

before_install:
  - curl -Ls https://raw.githubusercontent.com/unb-libraries/dockworker/3.x/scripts/travis/init.sh | bash
  - composer install

script:
  - set -e
  - vendor/bin/dockworker local:build-test
  - vendor/unb-libraries/dockworker/scripts/kubectl/init.sh
  - vendor/bin/dockworker image:deploy $TRAVIS_BRANCH
  - vendor/bin/dockworker deployment:logs:check $TRAVIS_BRANCH

notifications:
  slack:
    rooms:
      secure: LLHbgMLbOavFN6h+xWZBS571j/cblxY7UA6lH6Qr4wc4jhqGgPhXVVrauRTwlw34tNNVdo3WcqFpEI0wN1ud3dyWFF3BnWDAheXz3hCAFxn1sooWrkpM3cdYdSfaZr2CLgc53AWAOx2XNnFxrA9m3EqTmkmqqQMu/PZTvJevTqkjEHeXgT2keKLlL3vBfAcY9WRTQ+64N+lFMA8NAod6KbtvHkbrXoYpUH6L6bmbDcK4S7etWhoRVNYaje2S38+hHrVGX4ePJBU2piYVYFl1C3TTj1OdRBEBD66IKcCtTEm5V858UCAZqgUWqBENzqvyjgeYBu/UE14hYire/wrT2nPMflxXF4YLnSbcfhKbk7BBgDm8p3b34vUk2JIb9Nv6nhQmUXpFH896/vcIjFoeZAluxUqU7pUbsVXZn5T7zOpVa6Y7UspSCi1hX33q/J3TyLmxvFDiTf/IAvbMkwMfaXKqti3l/RhXMnKZIa9iDVz7eJ6Mjdm6IvHp8ko54vQyIpUG1/FE9B7DX16NiFNFYuOycFwqPwKYZhdRLBbw6cYxUMvwnYl1i4/CUgV9jeLY1fvO1fTdo+Bx4oD9hxn32JgzYVqKGIISZt4RrjjC0kXPstqjO08ZxwyrPjtpF0mby7vLWcfmvL26HSil+SwPOrWNoqWmHPsaP2uiV6wapSk=
    on_start: always
    on_success: always
